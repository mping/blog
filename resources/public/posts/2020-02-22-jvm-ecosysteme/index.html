<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>(mcorbin.fr): la JVM, Java, ses haters, son écosystème</title>
    <link rel="canonical" href="https://mcorbin.fr/posts/2020-02-22-jvm-ecosysteme/">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/styles/tomorrow-night.css" rel="stylesheet" type="text/css" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />

  </head>
  <body><a name="top"></a>
    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar1" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">(mcorbin.fr)</a>
        </div>
        <div id="navbar1" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li ><a href="/">Home</a></li>
            <li
               ><a href="/archives/">Archives</a></li>
            
            <li
               >
              <a href="/pages/about/">About</a>
            </li>
            
            <li
               >
              <a href="/pages/projects/">Projects</a>
            </li>
            
            <li><a href="/feed.xml">RSS</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div><!--/.container-fluid -->
    </nav>


    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div id="content">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">22 février 2020</div>
        
    </div>
    <h2>la JVM, Java, ses haters, son écosystème</h2>
</div>
<div>
    
    <div class="paragraph">
<p>Comme beaucoup de monde, j&#8217;ai eu l&#8217;occasion de travailler professionnellement avec Java (et je continue de le faire ponctuellement aujourd&#8217;hui). Dans cet article, je parlerais de la JVM, de Java, et de la (mauvaise) réputation que ce langage se traîne. Mais cette dernière est-elle vraiment justifiée ?</p>
</div>
<div class="sect1">
<h2 id="_la_jvm">la JVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je pense que la JVM est probablement la plateforme la plus mature pour développer des applications aujourd&#8217;hui. Elle a en effet plusieurs avantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>De très très bonnes performances.</p>
</li>
<li>
<p>Un écosystème énorme. Il existe des clients écrits en Java pour à peu près toutes les bases de données, broker de messages etc&#8230;&#8203; disponibles sur le marché. Ces clients sont de plus généralement des clients officiels maintenus par les développeurs du produit. La librairie standard est également très riche.</p>
</li>
<li>
<p>De nombreux langages disponibles (Java, Clojure, Scala, Kotlin, Groovy&#8230;&#8203;), tous bénéficiant de l&#8217;écosystème et des performances de la JVM.</p>
</li>
<li>
<p>Il est très facile aujourd&#8217;hui de déployer des applications sur la JVM. Généralement installer la JVM puis lancer un <code>java -jar app.jar</code> suffit, des outils comme <code>jlink</code> permettent même d&#8217;optimiser cela.</p>
</li>
<li>
<p>De nombreuses innovations apparaissent sur la JVM ou danss on écosystème, comme par exemple <code>GraalVM</code>, les différents types de garbage collector etc&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Je développe depuis plusieurs années sur la JVM (en Clojure majoritairement aujourd&#8217;hui), et j&#8217;en ai toujours été très content.</p>
</div>
<div class="paragraph">
<p>Et pourtant&#8230;&#8203; Quand je présente un de mes projets open source écrit en Clojure, j&#8217;ai régulièrement droit à des:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pourquoi ça tourne sur la JVM ?</p>
</li>
<li>
<p>Jamais je ne déployerais des application sur la JVM de nouveau, c&#8217;est l&#8217;enfer à gérer !</p>
</li>
<li>
<p>Mon expérience de la JVM a toujours été désastreuse !</p>
</li>
<li>
<p>Tourner sur la JVM n&#8217;est pas un avantage.</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C&#8217;est aussi quelque chose qu&#8217;on voit souvent sur les réseaux sociaux. La JVM serait lente, consommerait beaucoup de ram, les applications seraient difficiles à maintenir&#8230;&#8203;<br>
Pourtant, comme dit précédemment, il est facile de faire des applications très performantes consommant quelques centaines de Mo de RAM. On voit d&#8217;ailleurs bien que la JVM est performante vu la quantité d&#8217;outils "Big Data" tournant dessus.</p>
</div>
<div class="paragraph">
<p>Mais alors, comment en est-on arrivé là ?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_langage_java">Le langage Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certains diront que la faute revient à Java. Ce langage serait lourd, verbeux, et ce serait un calvaire de développer des applications en Java.</p>
</div>
<div class="paragraph">
<p>C&#8217;est vrai, Java a des inconvénients mais ce n&#8217;est pas le pire langage du monde. De plus, le langage s&#8217;améliore (certes lentement), mais ça va dans le bon sens.<br></p>
</div>
<div class="paragraph">
<p>Le langage n&#8217;a pas un système de type digne des langages fortements typés comme Ocaml ou Rust, le "tout objet" du langage est parfois lourd, l&#8217;immuabilité n&#8217;est pas vraiment encouragé, la programmation fonctionnelle est limitée&#8230;&#8203; Mais on peut largement travailler avec.</p>
</div>
<div class="paragraph">
<p>D&#8217;ailleurs, la critique de Java est encore plus savoureuse quand elle vient de développeurs Golang (je développe aussi en Golang, vous pouvez retrouver mon avis sur le langage <a href="https://mcorbin.fr/posts/2019-06-13-one-year-of-go/">ici</a>). Java n&#8217;a rien à envier à Golang en terme de fonctionnalité.</p>
</div>
<div class="paragraph">
<p>Mais alors, quel est le problème ?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_serveurs_d_applications">Les serveurs d&#8217;applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une génération complète de développeurs et de sysadmin ont été traumatisé par les Glassfish, JBoss et autres Websphere.</p>
</div>
<div class="paragraph">
<p>J&#8217;ai eu la chance de commencer ma carrière vers la fin de leurs utilisations (bon il y en a toujours qui tournent en prod aujourd&#8217;hui mais ça se voit moins on va dire), et en effet j&#8217;ai quelques souvenirs de fichiers <code>domain.xml</code> bien violents (le tout branché sur de l&#8217;Oracle sur AIX histoire de bien faire les choses).</p>
</div>
<div class="paragraph">
<p>Mais comme dit précédemment, aujourd&#8217;hui un <code>java -jar</code> suffit généralement pour lancer une application. Mais cette époque a fait du dégât, généralement les remarques du type "OMG Java en prod plus jamais!" viennent de gens ayant connu cette époque.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_frameworks_java">Les frameworks Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour moi, la mauvaise réputation de Java aujourd&#8217;hui vient principalement de ses frameworks (et non du langage, j&#8217;insiste sur ce point).<br>
Il y a une culture de l&#8217;usine à gaz difficile à comprendre dans la communauté Java, et c&#8217;est quelque chose que je n&#8217;ai jamais vu dans d&#8217;autres langages ou communautés. L&#8217;expression <code>pourquoi faire simple quand on peut faire compliqué</code> prend ici tout son sens. L&#8217;exemple type de cette culture étant Spring.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_c_est_quoi_le_problème_avec_spring">C&#8217;est quoi le problème avec Spring ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>J&#8217;ai eu l&#8217;occasion de travailler professionnellement sur des projets Spring dans plusieurs contextes. Je parle ici de projets avec du Spring "modernes": Spring Boot, Spring Cloud, "microservices"&#8230;&#8203; Et c&#8217;était à peu près ma réaction quand j&#8217;arrivais sur les projets:</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="/img/jvm-ecosysteme/wtf.gif" alt="what the fuck"></span></p>
</div>
<div class="paragraph">
<p>On me disait <em>tu verras, c&#8217;est des stacks modernes !</em> Quel naïf j&#8217;étais ! Essayons de résumer un projet Java/Spring comme ils sont faits aujourd&#8217;hui.</p>
</div>
<div class="sect2">
<h3 id="_génération_du_projet">Génération du projet</h3>
<div class="paragraph">
<p>Les développeurs adorent générer les projets via des archetypes Maven, ou si vous n&#8217;avez pas de chance avec <a href="https://mcorbin.fr/posts/2018-02-08-spring-generateur/">JHipster</a>.<br>
Vous n&#8217;avez pas commencé à coder, mais vous avez déjà 25 classes et un pom.xml de 2000 lignes. Soyons franc, la seule chose à faire après ça devrait être <code>rm -rf *</code> et repartir sur des bases saines, mais bon, c&#8217;est comme ça qu&#8217;il faut faire il paraît.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotation">Annotation</h3>
<div class="paragraph text-center">
<p><span class="image"><img src="/img/jvm-ecosysteme/annotation.jpg" alt="tout doit être annoté"></span></p>
</div>
<div class="paragraph">
<p>Le projet devient un jeu où le but est simple: le mot-clé <code>new</code> est interdit. Plus il y a de magie, plus il y a d&#8217;annotations, mieux c&#8217;est.<br>
Métriques ? Annotations. Mocks ? Annotations. Dépendances ? Annotations. Getters ? Annotation (coucou lombok). Routes HTTP ? Annotations. Cache de la DB ? Annotation. Mapping entre objets ? Annotations. Je pourrais continuer comme ça longtemps.</p>
</div>
<div class="paragraph">
<p>La plupart des projets pourraient avoir une class Main qui serait plus ou moins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Cache cache = new cache(cacheConfig)
Database database = new Database(databaseConfig);
HTTPServer server = new HTTPServer(cache, database);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Où database et cache implémentent une interface (pour écrire facilement un mock).<br>
Bien sûr, comme dit précédemment utiliser <code>new</code> est interdit, donc vous ne verrez jamais ça. J&#8217;ai eu des discussions hallucinantes où les devs ne pouvaient même pas envisager ne pas utiliser <code>@inject</code>, comme si on leur demandait de coder avec <code>ed</code> à la place de leur IDE.</p>
</div>
<div class="paragraph">
<p>On préfère avoir une mega usine à gaz qui explose au runtime (bah oui, c&#8217;est super utile d&#8217;avoir du typage statique quand derrière on a du <code>bean not found</code> au démarrage du projet, démarrage qui met 2 plombes au passage généralement).</p>
</div>
</div>
<div class="sect2">
<h3 id="_utilisez_les_libs_les_plus_bloated_de_l_écosystème">Utilisez les libs les plus bloated de l&#8217;écosystème</h3>
<div class="paragraph">
<p>Rule 34: <code>IF IT EXISTS, THERE IS A SPRING STARTER FOR IT</code>.</p>
</div>
<div class="paragraph">
<p>Vous ne pensiez quand même pas pouvoir utiliser les clients officiels Kafka, Elasticsearch etc&#8230;&#8203; quand même ?<br></p>
</div>
<div class="paragraph">
<p>Non, il faut utiliser Spring Kafka, Spring Data Elasticsearch, &#8230;&#8203; Ces libs cachent les implémentations officiels, sont très peu flexibles, et sont surtout totalement inutiles (bah oui, faire <code>kafkaConsumer consumer = new KafkaConsumer(config)</code> c&#8217;est trop compliqué). Mais bon, le but de ces frameworks est de cocher des cases, pour pouvoir dire "Oui c&#8217;est supporté !!" dès qu&#8217;une techno est mentionnée en réunion.</p>
</div>
<div class="paragraph">
<p>JPA, AspectJ, Hibernate&#8230;&#8203; Il y aurait tellement de choses à dire sur ces technos sorties de l&#8217;enfer.<br></p>
</div>
<div class="paragraph">
<p>Spring Data ? True story: j&#8217;arrive sur un projet (gnagna microservices, gnagna stack moderne on est le meilleur projet de la ville etc&#8230;&#8203;), j&#8217;ouvre un fichier, je tombe sur une tonne de fonctions ressemblant à:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLibelleIgnoreCaseContainingOrOuvrageIgnoreCaseContainingOrCreatedByIgnoreCaseContaining</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>WTF</code></strong> ? C&#8217;est un vrai nom de fonction qui était dans le projet hein, que j&#8217;ai conservé précieusement pour la ressortir. C&#8217;est un peu à ce moment où je me suis dis que je devais soit repasser sysadmin, soit trouver une boîte qui ne fait pas du Java (j&#8217;ai fait l&#8217;un puis l&#8217;autre d&#8217;ailleurs). Et ces fonctions ne choquaient <strong>PERSONNE</strong> sur le projet, c&#8217;était business as usual.</p>
</div>
</div>
<div class="sect2">
<h3 id="_design_pattern">Design pattern</h3>
<div class="paragraph">
<p>Une classe <strong>==</strong> une interface, c&#8217;est la règle ! Chaque requête HTTP faisant un accès à une base de données devra aussi au moins créer: un DAO, un DTO, un VO. Pourquoi ? Car ça fait 20 ans qu&#8217;on cargo cult le Gang of Four.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hiérarchie_de_pom_complexe">Hiérarchie de pom complexe</h3>
<div class="paragraph">
<p>Avec les starters Spring et compagnie, votre pom.xml fait maintenant 3500 lignes. Sauf qu&#8217;en fait le pom a aussi un pom "parent", un "BOM"&#8230;&#8203; Chaque montée de version d&#8217;un de ces trucs vous coûtera des jours de travail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_montées_de_versions">Montées de versions</h3>
<div class="paragraph">
<p>D&#8217;ailleurs, parlons en des montées de versions. Chaque montée de version de Spring et de ses starters amènera son lot de bugs bien louches, et beaucoup de projets/libs n&#8217;ont même pas de changelog donc amusez vous bien lors du débugging.</p>
</div>
</div>
<div class="sect2">
<h3 id="_faites_ch_er_les_ops_au_maximum">Faites ch*er les ops au maximum</h3>
<div class="paragraph">
<p>La stack Spring Cloud Netflix (Ribbon &amp; co) est un enfer.</p>
</div>
<div class="paragraph">
<p>Votre projet est maintenant un load balancer bugué, pas flexible, exposant très difficilement ses métriques. C&#8217;est toujours cool quand on on se rend compte que N % des requêtes partent dans les limbes sans avoir aucune métrique et aucun moyen de débuguer le truc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_de_toute_façon_personne_ne_comprend_comment_ça_marche">De toute façon, personne ne comprend comment ça marche</h3>
<div class="paragraph">
<p>J&#8217;ai travaillé avec de très bons développeurs Java, certains "connus". Des devs qui en font depuis <code>199X</code>. Des gens qui font du Spring depuis le tout début. Même eux ne pourront pas vous aider, le framework est juste trop complexe. Et quand ton annotation marche pas car un truc rentre en conflit avec un autre, va trouver la source du problème&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Je me rappelle d&#8217;une montée de version de Spring où mon CTO de l&#8217;époque avait tweeté <em>Quelle douleur les montées de version spring et ces dépendances. A la limite de l&#8217;abandon mais toujours en cours</em>. Oui, les montées de versions étaient <strong>dingues</strong>, de mémoire celle là commençait à se compter en mois.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mais_pourtant">Mais pourtant&#8230;&#8203;</h3>
<div class="paragraph">
<p>Malgré cette complexité <strong>ENORME</strong>, il ne faut surtout pas changer ! Incompréhensible.</p>
</div>
<div class="paragraph">
<p>Tu passes 2 semaines sur un bug Ribbon, tu mets 1 mois à monter de version Spring, tu mets 3 jours à monter de version ton pom parent, ton "microservice" avec 10 endpoints REST a 60 classes, 10 000 de code et a un pom de 3000 lignes&#8230;&#8203; Mais tout le monde est content et continue dans sa lancée !</p>
</div>
<div class="paragraph">
<p>Sur un des projets où je suis intervenu, quelques développeurs (généralement ceux qui avaient codés avec autre chose que Java dans leurs carrières) voulaient lancer un microservice avec <code>Vert.x</code> pour tester (certains l&#8217;avaient déjà utilisés en prod, d&#8217;ailleurs j&#8217;en ai également entendu de bons retours).<br>
Bien sûr les autres développeurs étaient contre (fallait faire du microservice mais SPRING), et d&#8217;ailleurs les décideurs étaient aussi contre car <em>Quand je demande à la SSII du coin des développeurs Spring ils en ont en stock</em>. OK.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_un_nouvel_espoir">Un nouvel espoir ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mais de nouveaux frameworks Java apparaissent, amenant simplicité avec eux&#8230;&#8203; Ah non, on me souffle dans l&#8217;oreillette que les Quarkus, Micronaut &amp; co vous feront aussi faire de l&#8217;annotation driven development.</p>
</div>
<div class="paragraph">
<p>Et c&#8217;est pourquoi j&#8217;ai arrêté de coder en Java.</p>
</div>
</div>
</div>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/programming/">programming</a>
    
</div>


    <div id="prev-next">
        
        
        <a class="right" href="/posts/2020-02-13-informatique-coeur-metier/">L&#39;informatique, c&#39;est pas notre coeur de métier ! &raquo;</a>
        
    </div>

    


</div>

            <a href="#top" class="alink" >Top of page</a>
          </div>
        </div>
      </div>
      <footer>Copyright &copy; 2020 mcorbin</footer>
    </div>
    <script src="/js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/js/highlight.pack.js" type="text/javascript"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
